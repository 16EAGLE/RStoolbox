---
layout: docu
title: '  '
fun:  fCover 
package:  RStoolbox 
header: Pages
group: navigation
---
{% include JB/setup %}
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Estimate fractional cover using image regression</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />

							<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/github.min.css">
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/languages/r.min.js"></script>
							<script>hljs.initHighlightingOnLoad();</script>
							</head><body>

<h3>Description</h3>

<p>fCover takes a classified high resolution image, e.g. vegetation and non-vegetation based on Landsat and calculates cover fractions for
pixels of a coarser resolution, e.g. MODIS.
</p>


<h3>Usage</h3>

<pre>
fCover(classImage, predImage, nSamples = 1000, classes = 1, model = "rf",
  tuneLength = 3, method = "cv", maxNA = 0, clamp = TRUE,
  filename = NULL, verbose, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>classImage</code></td>
<td>
<p>high resolution RasterLayer containing a landcover classification, e.g. as obtained by <a href="superClass.html">superClass</a>.</p>
</td></tr>
<tr valign="top"><td><code>predImage</code></td>
<td>
<p>coearse resolution RasterLayer for which fractional cover will be estimated.</p>
</td></tr>
<tr valign="top"><td><code>nSamples</code></td>
<td>
<p>Integer. Number of pixels to sample from predImage to train the regression model</p>
</td></tr>
<tr valign="top"><td><code>classes</code></td>
<td>
<p>Integer. Classes for which fractional cover should be estimated.</p>
</td></tr>
<tr valign="top"><td><code>model</code></td>
<td>
<p>Character. Which model to fit for image regression. See <a href="http://www.inside-r.org/packages/cran/caret/docs/train">train</a> for options. Defaults to randomForest ('rf')</p>
</td></tr>
<tr valign="top"><td><code>tuneLength</code></td>
<td>
<p>Integer. Number of levels for each tuning parameters that should be generated by train.</p>
</td></tr>
<tr valign="top"><td><code>method</code></td>
<td>
<p>Character. Resampling method for parameter tuning. Defaults to 10 fold cross-validation. See <a href="http://www.inside-r.org/packages/cran/caret/docs/trainControl">trainControl</a> for options.</p>
</td></tr>
<tr valign="top"><td><code>maxNA</code></td>
<td>
<p>Numeric. Maximal proportion of NAs allowed in training pixels.</p>
</td></tr>
<tr valign="top"><td><code>clamp</code></td>
<td>
<p>Logical. Enforce results to stay within [0,1] interval. Values &lt;0 are reset to 0 and values &gt;1 to 1.</p>
</td></tr>
<tr valign="top"><td><code>filename</code></td>
<td>
<p>Character. Raster filename.</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>Logical. Print progress information.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>further arguments to be passed to <a href="http://www.inside-r.org/packages/cran/caret/docs/trainControl">trainControl</a> and <code><a href="http://www.inside-r.org/packages/cran/raster/docs/writeRaster">writeRaster</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>fCover gets the pixel values in a high resolution classified image that correspond to
individual randomly selected moderate resolution pixels and then calculates the percent of
the classified image pixels that represent your cover type of interest. In other words, if
your high resolution image has a pixel size of 1m and your moderate resolution image has a
pixel size of 30m the sampling process would take a block of 900 of the 1m resolution pixels
that correspond to a single 30m pixel and calculate the percentage of the 1m pixels that
are forest. For example, if there were 600 forest pixels and 300 non-forest pixels the value
given for the output pixel would be 0.67 since 67
</p>
<p>fCover relies on train from the caret package which provides acces to a huge number of classifiers.
Please see the available options at <a href="http://www.inside-r.org/packages/cran/caret/docs/train">train</a>. The default classifier (randomForest) we chose has been shown
to provide very good results in image regression and hence its recomended you start with this one. If you choose a different
one, make sure it can run in regression mode.
</p>
<p>If you register a parallel backend before, model fitting will run in parallel.
</p>
<p>If the total no-data values for a block of high resolution pixels is greater than maxNA then
it will not be included in the training data set since there is too much missing data to provide
a reliable cover percentage. If the no-data proporton is less then maxNA the no-data pixels are removed
from the total number of pixels when calculating the percent cover.
</p>


<h3>Value</h3>

<p>Returns a list with two elements: models contains the fitted models evaluated in tenfold cross-validation (caret train objects);
fCover contains a RasterStack with a fractional cover layer for each requested <code>class</code>
</p>


<h3>See Also</h3>

<p><a href="superClass.html">superClass</a>
</p>


<h3>Examples</h3>

<pre><code class="r">library(raster)
library(caret)
</code></pre>

<pre><code>#&gt; Loading required package: lattice
</code></pre>

<pre><code class="r">## Create fake input images
data(rlogo)
lsat &lt;- rlogo
agg.level &lt;- 9
modis &lt;- aggregate(lsat, agg.level)

## Perform classification
lc    &lt;- unsuperClass(lsat, nClass=2)

## Calculate the true cover (possible in this example because the fake corse resolution imagery
## is exactly res(lsat)*9
trueCover &lt;- aggregate(lc$map, agg.level, fun = function(x, ...){sum(x == 1, ...)/sum(!is.na(x))})

## Run with randomForest and support vector machine (radial basis kernel)
## Of course the SVM is handicapped in this example due to poor tuning (tuneLength)
par(mfrow=c(2,3))
for(model in c(&quot;rf&quot;, &quot;svmRadial&quot;)){
   fc &lt;- fCover(
           classImage = lc$map ,
           predImage = modis,
           classes=1,
           model=model,
           nSample = 50,
           number = 5,
           tuneLength=2
   )

   ## How close is it to the truth?
   compare.rf &lt;- trueCover - fc$map
   plot(fc$map, main = paste(&quot;Fractional Cover: Class 1\nModel:&quot;, model))
   plot(compare.rf, main = &quot;Diffence\n true vs. predicted&quot;)
   plot(trueCover[],fc$map[],  xlim = c(0,1), ylim =c(0,1),
           xlab = &quot;True Cover&quot;, ylab = &quot;Predicted Cover&quot; )
   abline(coef=c(0,1))
   rmse &lt;- sqrt(cellStats(compare.rf^2, sum))/ncell(compare.rf)
   r2 &lt;- cor(trueCover[], fc$map[], &quot;complete.obs&quot;)
   text(0.9,0.1,paste0(paste(c(&quot;RMSE:&quot;,&quot;R2:&quot;),
                           round(c(rmse, r2),3)),collapse=&quot;\n&quot;), adj=1)
}
</code></pre>

<pre><code>#&gt; Loading required package: randomForest
#&gt; randomForest 4.6-10
#&gt; Type rfNews() to see new features/changes/bug fixes.
</code></pre>

<pre><code>#&gt; Error in cut.default(y, breaks, include.lowest = TRUE): invalid number of intervals
</code></pre>

<pre><code class="r">## Reset par
par(mfrow=c(1,1))
</code></pre>


<hr /><div style="text-align: center;">[Package <em>RStoolbox</em> version 0.0.0.9000 <a href="00Index.html">Index</a>]</div>
</body></html>
