---
layout: docu
title: ' Very simple cloud detection for imagery with blue and thermal... '
fun:  cloudMask 
package:  RStoolbox 
header: Pages
group: navigation
---
{% include JB/setup %}
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>R: Very simple cloud detection for imagery with blue and thermal...</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="R.css">

							<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/github.min.css">
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/languages/r.min.js"></script>
							<script>hljs.initHighlightingOnLoad();</script>
							</head><body>

<h3>Description</h3>

<p>Very simple cloud detection for imagery with blue and thermal bands
</p>


<h3>Usage</h3>

<pre>
cloudMask(x, threshold, minCloudSize, windowSize1 = 5, windowSize2 = 11,
  maskGrowing = TRUE, sanitize = TRUE, lowBand = "B1", tirBand = "B6",
  plot = TRUE, verbose = TRUE, returnDiffLayer = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>RasterBrick or RasterStack with reflectance and brightness temperature OR the mask of a previous run of <code>cloudMask</code> with <code>returnDiffLayer=TRUE</code>.</p>
</td></tr>
<tr valign="top"><td><code>threshold</code></td>
<td>
<p>cloud detection threshold. If not provided it will be guessed. Everything *above* this threshold will be considered a cloud pixel (unless it is removed by filtering afterwards).</p>
</td></tr>
<tr valign="top"><td><code>minCloudSize</code></td>
<td>
<p>minimum number of cloud pixels in window1</p>
</td></tr>
<tr valign="top"><td><code>windowSize1</code></td>
<td>
<p>odd number, rectangular moving window to remove clouds which are too small (likely artefacts)</p>
</td></tr>
<tr valign="top"><td><code>windowSize2</code></td>
<td>
<p>odd number, rectangular buffer around cluster centers</p>
</td></tr>
<tr valign="top"><td><code>maskGrowing</code></td>
<td>
<p>logical. Applies simple region-growing (rectangular buffering) to the cloud mask. If <code>TRUE</code> windowSize2 must be specified.</p>
</td></tr>
<tr valign="top"><td><code>sanitize</code></td>
<td>
<p>logical. Should small clouds (possibly false positives) be removed by filtering? If <code>TRUE</code> windowSize1 must be specified.</p>
</td></tr>
<tr valign="top"><td><code>lowBand</code></td>
<td>
<p>bandname or number for the blue band</p>
</td></tr>
<tr valign="top"><td><code>tirBand</code></td>
<td>
<p>bandname or number for the thermal band</p>
</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>
<p>logical. Provides plots of the cloud mask for all sub-steps (sanitizing etc.) Helpful to find proper parametrization.</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>logical. Print messages or suppress.</p>
</td></tr>
<tr valign="top"><td><code>returnDiffLayer</code></td>
<td>
<p>logical. If <code>TRUE</code>, the difference layer will be returned along with the cloudmask. This option allows to re-use the difference layer in cloudMask.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Typically clouds are cold in the thermal region and have high reflectance in short wavelengths (blue). By differencing the two bands and thresholding a rough cloud mask can be obtained.
More sophisticated approaches can be found elsewhere, e.g. <a href="http://code.google.com/p/fmask">fmask</a>.
</p>
<p>It can make sense to find a suitable threshold on a cropped version of the scene. Also make sure you make use of the <code>returnDiffLayer</code> argument to save yourself one processing step.
Sanitizing and region growing can be seen as final polishing, i.e. as long as the pure cloud centers are not detected properly, you can turn those two arguments off if they take too long to calculate.
Once your mask detects obvious cloud pixels properly re-enable sanitizing and regionGrowing for fine tuning if desired. Finally, once a suitable threshold is established re-run cloudMask on the whole scene with this threshold and go get a coffee.
</p>


<h3>Examples</h3>

<pre><code class="r">## Not run: 
##D ls &lt;- stackMeta(&quot;path/to/MTL.txt&quot;)
##D ls_cor &lt;- radCor(ls, &quot;path/to/MTL.txt&quot;)
##D ls_cmask &lt;-cloudMask(ls_cor, returnDiffLayer = TRUE)
## End(Not run)
</code></pre>


<hr><div align="center">[Package <em>RStoolbox</em> version 0.0.0.9000 <a href="00Index.html">Index</a>]</div>
</body></html>
