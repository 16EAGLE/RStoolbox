---
layout: docu
title: '  '
fun:  cloudMask 
package:  RStoolbox 
header: Pages
group: navigation
---
{% include JB/setup %}
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Simple Cloud Detection</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />

							<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/github.min.css">
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/languages/r.min.js"></script>
							<script>hljs.initHighlightingOnLoad();</script>
							</head><body>

<h3>Description</h3>

<p>Developed for use with Landsat data <code>cloudMask</code> relies on the distinctive difference between the blue (or any other short-wave band)
and thermal band for semi-automated creation of a cloud mask. Since it relies on thermal information it doesn't work well for sensors without
thermal bands.
</p>


<h3>Usage</h3>

<pre>
cloudMask(x, threshold = 0.8, blue = "B1_sre", tir = "B6_sre",
  buffer = NULL, plot = FALSE, verbose)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>RasterBrick or RasterStack with reflectance and brightness temperature OR the mask of a previous run of <code>cloudMask</code> with <code>returnDiffLayer=TRUE</code>.</p>
</td></tr>
<tr valign="top"><td><code>threshold</code></td>
<td>
<p>cloud detection threshold. If not provided it will be guessed. Everything *below* this threshold will be considered a cloud pixel (unless it is removed by filtering afterwards).</p>
</td></tr>
<tr valign="top"><td><code>blue</code></td>
<td>
<p>bandname or number for the blue band</p>
</td></tr>
<tr valign="top"><td><code>tir</code></td>
<td>
<p>bandname or number for the thermal band</p>
</td></tr>
<tr valign="top"><td><code>buffer</code></td>
<td>
<p>Integer (number of pixels). If given, a buffer will be added to the identified cloud centers.</p>
</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>
<p>logical. Plots of the cloud mask for all sub-steps (sanitizing etc.) Helpful to find proper parametrization.</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>logical. Print messages or suppress.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Typically clouds are cold in the thermal region and have high reflectance in short wavelengths (blue). By calculating a normalized difference index between the two bands and thresholding a rough cloud mask can be obtained.
Before calculating the normalized difference thermal cloud index (NDTCI) the thermal band will be matched to the same value range as the blue band. Therefore, it doesn't matter whether you
provide DN, radiance or brightness temperature.
</p>
<p>This approach to cloud masking is very simplistic. And aims only at rough removal of potentially clouded areas. Nevertheless, it is able to provide satisfactory results.
More sophisticated approaches, including cloud cast shadow detection can be found elsewhere, e.g. <a href="http://code.google.com/p/fmask">fmask</a>.
</p>
<p>It can make sense to find a suitable threshold on a cropped version of the scene. Also make sure you make use of the <code>returnDiffLayer</code> argument to save yourself one processing step.
Buffering should be seen as final polishing, i.e. as long as the pure cloud centers are not detected properly, you might want to turn it off. since it takes some time to calculate.
Once your mask detects obvious cloud pixels properly re-enable buffering for fine tuning if desired. Finally, once a suitable threshold is established re-run cloudMask on the whole scene with this threshold and go get a coffee.
</p>


<h3>See Also</h3>

<p><a href="http://www.inside-r.org/packages/cran/raster/docs/mask">mask</a>
</p>


<h3>Examples</h3>

<pre><code class="r">ls &lt;- stackMeta(&quot;path/to/MTL.txt&quot;)
</code></pre>

<pre><code>#&gt; Error: Metadata file does not exist. Looking for: path/to/MTL.txt
</code></pre>

<pre><code class="r">ls_cor &lt;- radCor(ls, &quot;path/to/MTL.txt&quot;)
</code></pre>

<pre><code>#&gt; Error: Metadata file does not exist. Looking for: path/to/MTL.txt
</code></pre>

<pre><code class="r">ls_cmask &lt;-cloudMask(ls_cor, returnDiffLayer = TRUE)
</code></pre>

<pre><code>#&gt; Error in cloudMask(ls_cor, returnDiffLayer = TRUE): unused argument (returnDiffLayer = TRUE)
</code></pre>


<hr /><div style="text-align: center;">[Package <em>RStoolbox</em> version 0.0.0.9000 <a href="00Index.html">Index</a>]</div>
</body></html>
