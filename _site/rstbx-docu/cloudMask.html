
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> Very simple cloud detection for imagery with blue and thermal... </title>
    <meta name="author" content="Benjamin Leutner">
    <link href='http://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
    <link href='/assets/themes/the-minimum/css/style.css' rel="stylesheet" media="all">
    <link href="http://feeds.feedburner.com/" rel="alternate" title=" Very simple cloud detection for imagery with blue and thermal... " type="application/atom+xml">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>

<body>
    <div id="page" class="hentry">
        <header class="the-header">
            <div class="unit-head">
                <div class="unit-inner unit-head-inner">

                    <nav class="nav-global">
                        <ul>
                            <li class="page"><a href="/">Home</a>
                            </li>
                            <li class="page"><a href="/pages.html">Blog</a>
                            </li>
                            <li class="documentation"><a href="/rstbx-docu">Documentation</a>
                            </li>
                            <li class="category"><a href="/about.html">About</a>
                            </li>

                        </ul>
                    </nav>
                </div>
                <!-- unit-inner -->
            </div>
            <!-- unit-head -->
        </header>
        <div class="body" role="main">
            <div class="unit-body">
                <div class="unit-inner unit-body-inner">
                    <div class="entry-content">
                        
<article class="unit-article layout-page">
    <div class="unit-inner unit-article-inner">
        <div class="content">
            <header>
                <div class="unit-head">
                    <a class="logobox" href="/"><img alt="RStoolbox-logo" src="/assets/img/rstbx.png"> </a>

                    <div class="unit-inner unit-head-inner">
                        <div class="h4 entry-title"> 
                            <table width="100%"><tr><td><strong>cloudMask<strong> { <a href="index.html">RStoolbox</a>}</td><td align="right">R Documentation</td></tr></table>
                            <h3> Very simple cloud detection for imagery with blue and thermal... </h2>
                        </div>
                    </div>
                    <!-- unit-inner -->
                </div>
                <!-- unit-head -->
            </header>

            <div class="bd">
                <div class="entry-content">
                    
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>R: Very simple cloud detection for imagery with blue and thermal...</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="R.css">

							<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/github.min.css">
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
							<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/languages/r.min.js"></script>
							<script>hljs.initHighlightingOnLoad();</script>
							</head><body>

<h3>Description</h3>

<p>Very simple cloud detection for imagery with blue and thermal bands
</p>


<h3>Usage</h3>

<pre>
cloudMask(x, threshold, minCloudSize, windowSize1 = 5, windowSize2 = 11,
  maskGrowing = TRUE, sanitize = TRUE, lowBand = "B1", tirBand = "B6",
  plot = TRUE, verbose = TRUE, returnDiffLayer = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>RasterBrick or RasterStack with reflectance and brightness temperature OR the mask of a previous run of <code>cloudMask</code> with <code>returnDiffLayer=TRUE</code>.</p>
</td></tr>
<tr valign="top"><td><code>threshold</code></td>
<td>
<p>cloud detection threshold. If not provided it will be guessed. Everything *above* this threshold will be considered a cloud pixel (unless it is removed by filtering afterwards).</p>
</td></tr>
<tr valign="top"><td><code>minCloudSize</code></td>
<td>
<p>minimum number of cloud pixels in window1</p>
</td></tr>
<tr valign="top"><td><code>windowSize1</code></td>
<td>
<p>odd number, rectangular moving window to remove clouds which are too small (likely artefacts)</p>
</td></tr>
<tr valign="top"><td><code>windowSize2</code></td>
<td>
<p>odd number, rectangular buffer around cluster centers</p>
</td></tr>
<tr valign="top"><td><code>maskGrowing</code></td>
<td>
<p>logical. Applies simple region-growing (rectangular buffering) to the cloud mask. If <code>TRUE</code> windowSize2 must be specified.</p>
</td></tr>
<tr valign="top"><td><code>sanitize</code></td>
<td>
<p>logical. Should small clouds (possibly false positives) be removed by filtering? If <code>TRUE</code> windowSize1 must be specified.</p>
</td></tr>
<tr valign="top"><td><code>lowBand</code></td>
<td>
<p>bandname or number for the blue band</p>
</td></tr>
<tr valign="top"><td><code>tirBand</code></td>
<td>
<p>bandname or number for the thermal band</p>
</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>
<p>logical. Provides plots of the cloud mask for all sub-steps (sanitizing etc.) Helpful to find proper parametrization.</p>
</td></tr>
<tr valign="top"><td><code>verbose</code></td>
<td>
<p>logical. Print messages or suppress.</p>
</td></tr>
<tr valign="top"><td><code>returnDiffLayer</code></td>
<td>
<p>logical. If <code>TRUE</code>, the difference layer will be returned along with the cloudmask. This option allows to re-use the difference layer in cloudMask.</p>
</td></tr>
</table>


<h3>Note</h3>

<p>Typically clouds are cold in the thermal region and have high reflectance in short wavelengths (blue). By differencing the two bands and thresholding a rough cloud mask can be obtained.
More sophisticated approaches can be found elsewhere, e.g. <a href="http://code.google.com/p/fmask">fmask</a>.
</p>
<p>It can make sense to find a suitable threshold on a cropped version of the scene. Also make sure you make use of the <code>returnDiffLayer</code> argument to save yourself one processing step.
Sanitizing and region growing can be seen as final polishing, i.e. as long as the pure cloud centers are not detected properly, you can turn those two arguments off if they take too long to calculate.
Once your mask detects obvious cloud pixels properly re-enable sanitizing and regionGrowing for fine tuning if desired. Finally, once a suitable threshold is established re-run cloudMask on the whole scene with this threshold and go get a coffee.
</p>


<h3>Examples</h3>

<pre><code class="r">ls &lt;- stackMeta(&quot;path/to/MTL.txt&quot;)
</code></pre>

<pre><code>#&gt; Warning in file(file, &quot;rt&quot;): cannot open file &#39;path/to/MTL.txt&#39;: No such
#&gt; file or directory
</code></pre>

<pre><code>#&gt; Error in file(file, &quot;rt&quot;): cannot open the connection
</code></pre>

<pre><code class="r">ls_cor &lt;- radCor(ls, &quot;path/to/MTL.txt&quot;)
</code></pre>

<pre><code>#&gt; Warning in file(file, &quot;rt&quot;): cannot open file &#39;path/to/MTL.txt&#39;: No such
#&gt; file or directory
</code></pre>

<pre><code>#&gt; Error in file(file, &quot;rt&quot;): cannot open the connection
</code></pre>

<pre><code class="r">ls_cmask &lt;-cloudMask(ls_cor, returnDiffLayer = TRUE)
</code></pre>

<pre><code>#&gt; Error in match(x, table, nomatch = 0L): object &#39;ls_cor&#39; not found
</code></pre>


<hr><div align="center">[Package <em>RStoolbox</em> version 0.0.0.9000 <a href="00Index.html">Index</a>]</div>
</body></html>

                </div>
                <!-- entry-content -->
            </div>
            <!-- bd -->

            <footer class="unit-foot">
                <div class="unit-inner unit-foot-inner">
                    <p class="gotop">
                        <a href="#page">Back to Top</a>
                    </p>
                </div>
            </footer>

        </div>
        <!-- content -->
    </div>
    <!-- unit-inner -->
</article>
                    </div>
                </div>
                <!-- unit-inner -->
            </div>
            <!-- unit-body -->
        </div>
        <!-- body -->
        <footer class="the-footer">
            <div class="unit-foot">
                <div class="unit-inner unit-foot-inner">
                    <div class="misc vcard">
                        <div>
                            <p>Last update 2015-03-08 23:17:31 +0100</p>
                        </div>
                        <h4>about</h4>
                        <ul>

                            <li class="contact"><address><span class="author fn n">Benjamin Leutner</span> - <span class="fn email">benjamin.leutner@uni-wuerzburg.de</span></address>
                            </li>
                            <li class="github"><a href="http://github.com/bleutner/" rel="me">github.com/bleutner</a>
                            </li>
                           <!-- <li class="rss"><a href="http://feeds.feedburner.com/">Subscribe to RSS Feed</a>
                            </li>-->
                        </ul>
                    </div>
                    <!-- misc -->
                    <p class="tinyfoot">
                        This site is powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>. The original theme was <a href="http://layouts-the.me/">Theme: the_minimum</a>
                        </br>
                       <a href="impressum.html">Impressum</a>
                    </p>
                </div>
                <!-- unit-foot-inner -->
            </div>
            <!-- unit-foot -->
        </footer>
    </div>
    <!-- page -->
    <script>
        (function (d, s) {
            var js, fjs = d.getElementsByTagName(s)[0],
                load = function (url, id) {
                    if (d.getElementById(id)) {
                        return;
                    }
                    js = d.createElement(s);
                    js.src = url;
                    js.id = id;
                    fjs.parentNode.insertBefore(js, fjs);
                };
            load('//platform.twitter.com/widgets.js', 'tweetjs');
            // load('https://apis.googlecom/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
            // load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/rstbx-docu/cloudMask.html" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
        }(document, 'script'));
    </script>
    <script>
        /*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
        (function (j) {
            var i = j.document;
            if (!i.querySelectorAll) {
                return
            }
            var l = i.querySelectorAll("meta[name=viewport]")[0],
                a = l && l.getAttribute("content"),
                h = a + ", maximum-scale=1.0",
                d = a + ", maximum-scale=10.0",
                g = true,
                c = j.orientation,
                k = 0;
            if (!l) {
                return
            }

            function f() {
                l.setAttribute("content", d);
                g = true
            }

            function b() {
                l.setAttribute("content", h);
                g = false
            }

            function e(m) {
                c = Math.abs(j.orientation);
                k = Math.abs(m.gamma);
                if (k > 8 && c === 0) {
                    if (g) {
                        b()
                    }
                } else {
                    if (!g) {
                        f()
                    }
                }
            }
            j.addEventListener("orientationchange", f, false);
            j.addEventListener("deviceorientation", e, false)
        })(this);
    </script>

    
</body>

</html>
